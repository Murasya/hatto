<ons-page>
  <ons-bottom-toolbar>
    <div class="left" style="text-align: left;"><ons-back-button></ons-back-button></div>
    <div class="center">記録一覧</div>
  </ons-bottom-toolbar>
  <ons-list id="commentList_c">
    
  </ons-list>
  <textarea placeholder="コメントを入力" id="comment_c"></textarea>
  <ons-button id="go_c">Go</ons-button>
  <script>
    ons.getScriptPage().onInit = function() {
      var db = firebase.firestore();
      var id = this.data.id;
      // commentList
      db.collection("comment").where("qid", "==", id).get().then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
          listItem(doc.data().comment);
        });
      });
      // commentRegister
      document.getElementById("go_c").onclick = function() {
        var comment = document.getElementById("comment_c").value;
        console.log(comment);
        db.collection("comment").add({
          qid: id,
          uid: localStorage.getItem("uid"),
          comment: comment,
          good: false,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(function(docRef) {
          console.log("Document written with ID: ", docRef.id);
          listItem(comment);
        })
        .catch(function(error) {
          console.log("Error adding document: ", error);
        });
        document.getElementById("comment_c").textContent = "";
      }
    }

    function listItem(comment) {
      var commentItem = document.createElement("ons-list-item");
      var right = document.createElement("div");
      right.setAttribute("class", "right");
      var icon = document.createElement("img");
      icon.setAttribute("class", "list-item__thumbnail");
      icon.setAttribute("src", "images/いいね（ハッとした！）_色無.png");
      right.appendChild(icon);
      var center = document.createElement("div");
      center.setAttribute("class", "center");
      center.textContent = comment;
      commentItem.appendChild(center);
      commentItem.appendChild(right);
      document.getElementById("commentList_c").appendChild(commentItem);
    }
    
  </script>
</ons-page>