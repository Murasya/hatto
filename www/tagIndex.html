<ons-page>
  <ons-bottom-toolbar>
    <div class="left" style="text-align: left;"><ons-back-button></ons-back-button></div>
    <div class="center">記録一覧</div>
  </ons-bottom-toolbar>
  <ons-tabbar swipeable position="auto" hide-tabs>
    <ons-tab page="tab1.html"></ons-tab>
    <ons-tab page="tab2.html"></ons-tab>
  </ons-tabbar>
  <script>
    ons.getScriptPage().onInit = function() {
      var db = firebase.firestore();
      var tabNames = ["Tab1", "Tab2"];
      var index = 0;
      db.collection('questionAndAnswer')
        .where("tags", "array-contains", this.data.tagName)
        .where("public", "==", true)
        .get()
        .then(function(querySnapshot) {
          //document.querySelector("ons-tabbar").addEventListener("prechange", function(event){
            querySnapshot.forEach(function(doc) {
              console.log(doc.id, " => ", doc.data());
              // page
              var page = document.getElementById(tabNames[index++]).firstElementChild.nextElementSibling;
              // tag
              var tags = document.createElement("div");
              doc.data().tags.forEach(t => {
                var tag = document.createElement("span");
                tag.textContent = t;
                tags.appendChild(tag);
              });
              page.appendChild(tags);
              // qanda
              var qanda = document.createElement("div");
              doc.data().answers.forEach(a => {
                var answer = document.createElement("p");
                answer.textContent = a;
                qanda.appendChild(answer);
              });
              page.appendChild(qanda);
              // memo
              var memo = document.createElement("div");
              memo.textContent = doc.data().memo;
              page.appendChild(memo);
              // button
              var person = document.createElement("a");
              var img = document.createElement("img");
              img.src = "images/個人ページ誘導ボタン.png";
              img.setAttribute("width", "50px");
              person.appendChild(img);
              person.onclick = function() {
                document.getElementById("myNavigator").pushPage('personal.html', {data: {id: doc.data().uid}});
              }
              page.appendChild(person);
              
              var comment = document.createElement("a");
              var img = document.createElement("img");
              img.src = "images/コメントボタン.png";
              img.setAttribute("width", "50px");
              comment.appendChild(img);
              comment.onclick = function() {
                document.getElementById("myNavigator").pushPage('comment.html', {data: {id: doc.id}});
              }
              page.appendChild(comment);

              var hatto = document.createElement("a");
              var img = document.createElement("img");
              img.src = "images/いいね（ハッとした！）_色無.png";
              img.setAttribute("width", "50px");
              hatto.appendChild(img);
              hatto.onclick = function() {
                document.getElementById("myNavigator").pushPage('addHattoList.html', {data: {id: doc.id}});
              }
              page.appendChild(hatto);
            });
          //});
        })
        .catch(function(error) {
          console.log("Error getting documents: ", error);
        });
    }
  </script>
</ons-page>